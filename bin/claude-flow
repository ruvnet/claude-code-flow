#!/usr/bin/env node

/**
 * Claude-Flow CLI wrapper
 * This wrapper script loads and executes the TypeScript CLI using Deno runtime
 */

const { spawn } = require('child_process');
const path = require('path');

// Get the directory where this script is located
const binDir = __dirname;
const projectRoot = path.join(binDir, '..');
const mainFile = path.join(projectRoot, 'src', 'cli', 'main.ts');

// Pass through all arguments to Deno
const args = [
  'run',
  '--allow-all',
  '--no-check',
  mainFile,
  ...process.argv.slice(2)
];

// Check if Deno is available
const denoPath = process.env.DENO_PATH || '/home/vscode/.deno/bin/deno' || 'deno';

// Spawn Deno process
const deno = spawn(denoPath, args, {
  stdio: 'inherit',
  env: {
    ...process.env,
    DENO_DIR: process.env.DENO_DIR || path.join(process.env.HOME, '.deno')
  }
});

// Handle process exit
deno.on('error', (err) => {
  if (err.code === 'ENOENT') {
    console.error('Error: Deno is not installed or not in PATH');
    console.error('Please install Deno: https://deno.land/manual/getting_started/installation');
    process.exit(1);
  } else {
    console.error('Error spawning Deno:', err);
    process.exit(1);
  }
});

deno.on('exit', (code) => {
  process.exit(code || 0);
});